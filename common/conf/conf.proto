syntax = "proto3";
package common.conf;

import "google/protobuf/duration.proto";
import "validate/validate.proto";

option go_package = "github.com/ydssx/kratos-kit/common/conf;conf";

message Bootstrap {
  string name = 1;
  string env = 2;
  Server server = 3 [(validate.rules).message.required = true];
  Data data = 4 [(validate.rules).message.required = true];
  Logger log = 5 [(validate.rules).message.required = true];
  Asynq asynq = 6 [(validate.rules).message.required = true];
  GoogleCloudStorage gcs = 7 [(validate.rules).message.required = true];
  Payment payment = 8 [(validate.rules).message.required = true];
  Facedetect facedetect = 9 [(validate.rules).message.required = true];
  Webhook webhook = 10 [(validate.rules).message.required = true];
  Aes aes = 11 [(validate.rules).message.required = true];
  string project_id = 12;
  Google google = 13 [(validate.rules).message.required = true];
  Email email = 14 [(validate.rules).message.required = true];
}

message Server {
  message HTTP {
    string network = 1;
    string addr = 2;
    google.protobuf.Duration timeout = 3;
    // 安全配置
    string jwt_secret = 4; // JWT密钥
    google.protobuf.Duration jwt_expiry = 5; // JWT过期时间
    float rate_limit = 6; // 请求速率限制
    int32 rate_burst = 7; // 速率限制突发值
    repeated string allow_origins = 8; // CORS允许的源
    Auth auth = 9; // 认证配置
    Security security = 10; // 安全配置
  }
  message GRPC {
    string network = 1;
    string addr = 2;
    google.protobuf.Duration timeout = 3;
  }
  HTTP http = 1;
  GRPC grpc = 2;
  bool enable_pprof = 3;
}

message Auth {
  string username = 1; // 基本认证用户名
  string password = 2; // 基本认证密码
}

message Security {
  bool enable_csrf = 1; // 启用CSRF保护
  bool enable_xss = 2; // 启用XSS保护
  bool enable_security_headers = 3; // 启用安全响应头
  repeated string csrf_exclude_paths = 4; // CSRF排除路径
}

message Data {
  message Database {
    string driver = 1;
    repeated string source = 2;
    // 数据库安全配置
    int32 max_open_conns = 3; // 最大打开连接数
    int32 max_idle_conns = 4; // 最大空闲连接数
    google.protobuf.Duration conn_max_lifetime = 5; // 连接最大生命周期
    bool enable_ssl = 6; // 启用SSL
    string ssl_ca = 7; // SSL CA证书路径
    string ssl_cert = 8; // SSL 证书路径
    string ssl_key = 9; // SSL 密钥路径
  }
  Database database = 1;
  Redis redis = 2;
  Mongo mongo = 3;
  Geoip geoip = 4;
  Redis job_redis = 5;
  Database event_database = 6;
}

message Redis {
  string addr = 1;
  string username = 2;
  string password = 3;
  google.protobuf.Duration read_timeout = 4;
  google.protobuf.Duration write_timeout = 5;
  google.protobuf.Duration dial_timeout = 6;
  int32 db = 7;
  // Redis安全配置
  bool enable_tls = 8; // 启用TLS
  bool tls_skip_verify = 9; // 跳过TLS验证
  int32 max_retries = 10; // 最大重试次数
  google.protobuf.Duration min_retry_backoff = 11; // 最小重试间隔
  google.protobuf.Duration max_retry_backoff = 12; // 最大重试间隔
}

message Mongo {
  string addr = 1;
  string username = 2;
  string password = 3;
  string database = 4;
  string collection = 5;
  google.protobuf.Duration read_timeout = 6;
  google.protobuf.Duration write_timeout = 7;
  google.protobuf.Duration dial_timeout = 8;
}

message Logger {
  string level = 1;
  string path = 2;
  bool enable_console = 3;
  int32 max_size = 4;
  int32 max_backups = 5;
  int32 max_age = 6;
  bool compress = 7;
}

message Asynq {
  int32 concurrency = 1;
  int32 max_retry = 2;
  bool strict_priority = 3;
}

message GoogleCloudStorage {
  string project_id = 1;
  string bucket_name = 2;
  string credentials_file = 3;
}

message Geoip {
  string path = 1;
}

message Payment {
  string notify_url = 1;
  string return_url = 2;
  string salt = 3;
  string secret_key = 4;
  string server_url = 5;
  string website = 6;
}

message Facedetect {
  string url = 1;
}

message Webhook {
  string url = 1;
  string order_notify_url = 2;
}

message Aes {
  string key = 1;
}

message Google {
  string client_id = 1;
  string client_secret = 2;
  string redirect_url = 3;
}

message Email {
  string host = 1;
  int32 port = 2;
  string username = 3;
  string password = 4;
  string from = 5;
}
